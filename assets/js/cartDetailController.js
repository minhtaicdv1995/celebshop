"use strict";function _objectSpread(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){_defineProperty(a,b,c[b])})}return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}(function(a){function b(){a("#cb5").prop("checked",!1),a("#cb6").prop("checked",!1),a("#cb7").prop("checked",!1)}// Get city and district
function c(){return d.apply(this,arguments)}function d(){return d=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(){var c,d,e,f,g,h,i,j;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c={action:"get_locations"// Call ajax to get all data of location
},b.next=3,callAjax("GET",c);case 3:d=b.sent,d.forEach(function(b){k.append(a("<option>",{value:b.term_id,text:b.name}))}),e=function(){var a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];a||k.find("option:gt(0)").remove(),l.find("option:gt(0)").remove()},f=[],n=function(b){// If exist parentId will load all data of district by parentId
if(b){var c=d.find(function(a){return a.term_id===b});// Get all districts and append to select box
c.childs.forEach(function(b){l.append(a("<option>",{value:b.term_id,text:b.name}))}),f=c.childs}// Else clear all data on select box
else e(!0)},k.change(/*#__PURE__*/function(){var b=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(c){var d,f;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:e(!0),d=c.currentTarget,f=parseInt(a(d).val()),n(f);case 4:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}()),g=a(".speed-fee"),h=a(".normal-fee"),i=function(a,b,c,d){b=parseFloat(b),a=b+a;// Card fee
var e=a*z;u.text(formatNumber(e,".")),a+=e,a=formatNumber(a),d.text(a)},j=function(a,b){var c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],d=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];b=parseFloat(b),0!==b&&b?(a.text("".concat(formatNumber(b,".")," VN\u0110")),(c||d)&&(p.text(formatNumber(b,".")),i(x,b,v,q))):(a.text("Mi\u1EC5n Ph\xED"),p.text(0),i(x,0,v,q)),w=b},o=function(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=f.find(function(a){return a.term_id===b}),e=d?d.speed_fee:0,i=d?d.normal_fee:0;null!==c&&(e=c,i=c),j(g,e),j(h,i,!0),t.change(function(b){var c=b.currentTarget,d=a(c).val();"speed"===d?j(g,e,!1,!0):j(h,i,!1,!0)})},l.change(/*#__PURE__*/function(){var b=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(c){var d,e,f,g,h,i,j;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return d=c.currentTarget,e=parseInt(a(d).val()),f={action:"checkAllPromotion",provinceId:e},b.next=5,callAjax("POST",f);case 5:g=b.sent,h=null,g&&(i=g.typeShipping,j=parseInt(g.priceShipping),i&&(h=j)),console.log(h),o(e,h);case 10:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}());case 15:case"end":return b.stop();}},b)})),d.apply(this,arguments)}function e(){return f.apply(this,arguments)}function f(){return f=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(c,d){var e,f,g;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,b.next=3,callAjax("POST",c);case 3:if(e=b.sent,e.code||e.success){b.next=9;break}return f=a(".error-quantity"),"OUT_OF_INVENTORY"===e.type?f.find(".item-notice").html("S\u1EA3n ph\u1EA9m hi\u1EC7n t\u1EA1i kh\xF4ng \u0111\u1EE7 size / s\u1ED1 l\u01B0\u1EE3ng b\u1EA1n c\u1EA7n"):"LIMITED_PRODUCTS"===e.type?f.find(".item-notice").html("C\xF3 s\u1EA3n ph\u1EA9m trong gi\u1ECF \u0111\xE3 \u0111\u01B0\u1EE3c mua qu\xE1 s\u1ED1 l\u01B0\u1EE3ng quy \u0111\u1ECBnh ho\u1EB7c b\u1EA1n \u0111\xE3 mua n\xF3 tr\u01B0\u1EDBc \u0111\xE2y"):"EXIST_PRODUCT_IS_PRE_ORDER"===e.type?f.find(".item-notice").html(e.errorData):f.find(".item-notice").html(e.message),f.css("display","block"),b.abrupt("return",!1);case 9:b.next=14;break;case 11:b.prev=11,b.t0=b["catch"](0),console.error(b.t0);case 14:if(!e){b.next=22;break}if(ggTrackingCheckOutStep(STEP_ORDER_COMPLETED),g=e.paymentUrl,g&&""!==g){b.next=21;break}return b.abrupt("return",d);case 21:return b.abrupt("return",g);case 22:return b.abrupt("return",!1);case 23:case"end":return b.stop();}},b,null,[[0,11]])})),f.apply(this,arguments)}function g(){return h.apply(this,arguments)}// Click to complete order
function h(){return h=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function c(d,f){var g;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return g=new jBox("Modal",{id:"jBoxTermPopup",addClass:"jBox-popupTerms",overlay:!0,isolateScroll:!1,closeOnClick:!1,content:A,onCreated:function onCreated(){this.wrapper.find("#cb1").click(function(){a("#templatePopupTerms .btn-yes").toggleClass("disabled")}.bind(this)),this.wrapper.find(".btn-no").click(function(){this.close(),this.wrapper.find("#cb1").prop("checked",!1),b()}.bind(this)),this.wrapper.find(".btn-yes").click(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(){var c;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!a("#cb1").is(":checked")){b.next=5;break}return b.next=3,e(d,f);case 3:c=b.sent,c?location.href=c:this.close();case 5:case"end":return b.stop();}},b,this)})).bind(this))},onCloseComplete:function onCloseComplete(){this.destroy()}}),g.open(),c.abrupt("return");case 3:case"end":return c.stop();}},c)})),h.apply(this,arguments)}// Fill value into input
function i(a,b){var c=!!(2<arguments.length&&arguments[2]!==void 0)&&arguments[2],d=findInputElementByName(a);d.val(b),c?addError(d):removeError(d)}// Fill value into select box
function j(a,b){var c=!!(2<arguments.length&&arguments[2]!==void 0)&&arguments[2],d=findSelectElementByName(a);// Base on id of city or district to set value for select box
"customerCity"===a&&n(b),"customerDistrict"===a&&o(b),d.val(b),c?addError(d,a,!0):removeError(d,!0)}var k=a("select[name=customerCity]"),l=a("select[name=customerDistrict]"),m=a("form#orderForm");l.length&&null==l.val()&&location.reload();// Declare function
// Load all district by city
var n,o,p=a("span.shipping-fee"),q=a("span.total-price"),r=a("span.current-price"),s=a("span.discount"),t=a("input[name=shippingType]"),u=a("span.card-fee"),v=convertNumberBy(r.text(),"."),w=convertNumberBy(p.text(),"."),x=convertNumberBy(q.text(),"."),y=convertNumberBy(u.text(),"."),z=0,A=a("#templatePopupTerms");// Get shipping price and append it to shippingPriceElement
k.length&&setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,c();case 2:case"end":return a.stop();}},a)})),0),a(".btn-complete-detail").click(/*#__PURE__*/function(){var b=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(c){var d,f,h,j,k,l,n,o,p,q,r,s,t,u,v,w,x,y,z;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(d=c.currentTarget,f=a(d).data("href"),h=[],a("#orderForm input[type='text'], #orderForm select").each(function(){var b=a(this),c=b.attr("name"),d=b.val(),e=b.prop("tagName").toLowerCase();"input"===e&&(""===d&&(addError(b),h.push(b)),"customerPhone"===c&&d&&!validatePhoneNumberWith10Characters(d)&&(addError(b,PHONE_INVALID),h.push(b))),"select"===e&&"0"===d&&(addError(b,null,!0),h.push(b))}),h&&h.length&&scrollToElement(h[0]),j=m.serializeArray().find(function(a){var b=a.name,c=a.value;// if (inputName === 'customerEmail') {
//     const checkValidate = validateEmail(inputValue); // Function validateEmail will be returned FALSE if value not an email
//     return !checkValidate; // Because function return false so I'll return it is true to get for error
// }
if("customerPhone"===b){var d=validatePhoneNumberWith10Characters(c);// Function validateEmail will be returned FALSE if value not an email
return!d;// Because function return false so I'll return it is true to get for error
}return""===c||"0"===c}),j){b.next=46;break}for(k=findInputElementByName("isNotification").is(":checked"),l=m.serializeArray().reduce(function(a,b){return a[b.name]=b.value,a},{}),l.isNotification=k,n=a(".listProductFromCart"),o=n.length,p=[],q=0;q<o;q++)r=a(n[q]),s={id:r.data("id"),size:r.data("size"),quantity:r.data("quantity")},p.push(s);if(t=a("#ananas_nounce").val(),u=_objectSpread({action:"create_order"},l,{listOfProduct:p,ananas_nounce:t}),u.paymentType&&void 0!==u.paymentType){b.next=21;break}return v=a(".error-quantity"),v.find(".item-notice").html("Vui l\xF2ng ch\u1ECDn ph\u01B0\u01A1ng th\u1EE9c thanh to\xE1n"),v.css("display","block"),b.abrupt("return");case 21:if(u.paymentType!==TYPE_DIRECT){b.next=28;break}return b.next=24,e(u,f);case 24:w=b.sent,w&&(location.href=w),b.next=30;break;case 28:return b.next=30,g(u,f);case 30:return b.abrupt("return");case 34:if(x=b.sent,x.code||x.success){b.next=40;break}return y=a(".error-quantity"),"OUT_OF_INVENTORY"===x.type?y.find(".item-notice").html("S\u1EA3n ph\u1EA9m hi\u1EC7n t\u1EA1i kh\xF4ng \u0111\u1EE7 size / s\u1ED1 l\u01B0\u1EE3ng b\u1EA1n c\u1EA7n"):y.find(".item-notice").html("L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"),y.css("display","block"),b.abrupt("return");case 40:b.next=45;break;case 42:b.prev=42,b.t0=b["catch"](31),console.error(b.t0);case 45:x&&(ggTrackingCheckOutStep(STEP_ORDER_COMPLETED),z=x.paymentUrl,location.href=z&&""!==z?z:f);case 46:case"end":return b.stop();}},b,null,[[31,42]])}));return function(){return b.apply(this,arguments)}}()),a(".checkToGetUserInfo").change(/*#__PURE__*/function(){var b=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(c){var d,e,f,g,h,k,l,m,n;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return d=c.currentTarget,e=a(d).is(":checked"),f={action:"getInfoUser"},b.next=5,callAjax("GET",f);case 5:// Call ajax to check user login
// If don't exist user then show error
if(g=b.sent,404===g.code)console.error(g.message),a(d).prop("checked",!1);else if(e){// Replace data
for(h in g)k=g[h],"customerCity"===h||"customerDistrict"===h?j(h,k):i(h,k);console.log(g),a(d).prop("checked",!0)}else for(m in l={customerName:null,customerPhone:null,customerEmail:null,customerAddress:null,customerCity:0,customerDistrict:0},l)n=l[m],"customerCity"===m||"customerDistrict"===m?j(m,n,!0):i(m,n,!0);case 7:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}()),a(".paymentType").change(/*#__PURE__*/function(){var b=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(c){var d,e,f,g,h,i;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return d=c.currentTarget,e=a(d).val(),b.next=4,callAjax("GET",{action:"get_payment_percent",paymentType:e});case 4:f=b.sent,g=f.paymentPercent,z=g,h=x+w,i=h*z,u.text(formatNumber(i,".")),h+=i,h=formatNumber(h),q.text(h);case 13:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}())})(jQuery);